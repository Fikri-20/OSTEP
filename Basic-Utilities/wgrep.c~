#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define MAX_LEN 1024;

char* find_line(FILE* f, char* target){
  char* line = NULL;
  size_t len = 0;
  ssize_t nread;

  while((nread = getline(&line, &len, f)) != -1){
    if(strstr(line, target)){
	  return line;
    }
  }

  free(line);
  return NULL;
}


int main(int argc, char* argv[argc+1]{
    if(argc == 1){
      printf("wgrep: searchterm [file ...]\n");
      exit(1);
    }

    if(argc == 2){
      int max_line = 1024;
      char line[max_line];
      

      while(fgets(line, sizeof(line), stdin)){
	if(strstr(line, argv[1])){
	  printf(line);
	  exit(0);
	}
      }
    }

    for(int i=1; i < argc; i++){
      FILE* f = fopen(argv[i], "r");
      if(!f){
	printf("wgrep: cannot open file\n");
	exit(1);
      }

      char* res = find_line(f, argv[1]);
      if(res){
	printf(res);
	fclose(f);
	exit(0);
      }
    }
    
}
